{
  "builders": [
    {
      "type": "googlecompute",
      "project_id": "project-af758472-c239-4625-869",
      "zone": "us-central1-a",
      "machine_type": "n2d-standard-4",
      "source_image_family": "centos-stream-9",
      "source_image_project_id": "centos-cloud",
      "subnetwork": "yugabyte-sub-1",
      "tags": ["allow-ssh", "yugabyte"],
      "omit_external_ip": false,
      "use_internal_ip": false,
      "service_account_email": "yugabyte@project-af758472-c239-4625-869.iam.gserviceaccount.com",
      "ssh_username": "cloud-user",
      "ssh_timeout": "15m",
      "metadata": {
        "enable-oslogin": "FALSE"
      },
      "image_name": "yugabyte-packer-vb2024-v1-{{timestamp}}",
      "image_storage_locations": ["us-central1"]
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "sudo dnf install -y openssh-server openssh-clients python3",
        "sudo systemctl enable sshd",
        "sudo systemctl restart sshd",
        "sudo ln -sf /usr/libexec/openssh/sftp-server /usr/lib/sftp-server"
      ]
    },
    {
      "type": "ansible",
      "user": "cloud-user",
      "playbook_file": "/home/adev4769/yugabytedb-cloud-automation-gcp/packers/yba_controller_node/yba_post_config_2024.yaml",
      "extra_arguments": [
        "-vvv",
        "--vault-id=default@/home/adev4769/yugabytedb-cloud-automation-gcp/packers/yba_controller_node/pass.txt"
      ],
      "ansible_env_vars": [
        "ANSIBLE_REMOTE_TMP=/tmp",
        "ANSIBLE_SSH_ARGS='-o ControlMaster=auto -o ControlPersist=60s -o PreferredAuthentications=publickey'",
        "ANSIBLE_PIPELINING=True"
      ],
      "use_proxy": false
    }
  ]
}